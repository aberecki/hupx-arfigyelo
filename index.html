<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUPX Árfigyelő</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        h1 { font-size: 24px; margin-bottom: 5px; }
        .subtitle { color: #888; font-size: 14px; margin-bottom: 20px; }
        
        .card-container {
            display: grid;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .time { font-size: 18px; font-weight: bold; }
        .price { font-size: 20px; font-weight: bold; }
        .unit { font-size: 12px; color: #aaa; }

        /* Színek */
        .cheap { border-left: 5px solid #00ff00; color: #00ff00; } /* Olcsó */
        .negative { border-left: 5px solid #00ffff; color: #00ffff; background-color: #003333; } /* Negatív */
        .expensive { border-left: 5px solid #ff4444; color: #ff4444; } /* Drága */
        .normal { border-left: 5px solid #888; color: #ddd; }

        #loading { margin-top: 50px; font-size: 18px; color: #888; }
    </style>
</head>
<body>

    <h1>HUPX Árak</h1>
    <div class="subtitle" id="date-display">Betöltés...</div>

    <div id="loading">Adatok lekérése... ⏳</div>
    <div class="card-container" id="app"></div>

    <script>
        async function loadPrices() {
            try {
                // 1. Adatok letöltése a JSON fájlból
                const response = await fetch('prices.json?v=' + new Date().getTime()); // Cache trükk
                if (!response.ok) throw new Error("Nincs adatfájl");
                const json = await response.json();

                // 2. Dátum frissítése
                document.getElementById('date-display').innerText = "Vizsgált nap: " + json.day;
                document.getElementById('loading').style.display = 'none';

                const container = document.getElementById('app');
                container.innerHTML = '';

                // 3. Kártyák gyártása
                json.data.forEach(item => {
                    const dateObj = new Date(item.time);
                    const hours = dateObj.getHours().toString().padStart(2, '0') + ":00";
                    
                    let priceClass = "normal";
                    let priceText = item.price_kwh.toFixed(4); // 4 tizedesjegy

                    // Színezési logika
                    if (item.price_kwh < 0) {
                        priceClass = "negative";
                        priceText += " ⚡ INGYEN";
                    } else if (item.price_kwh < 0.01) { // 10 Ft alatt (kb)
                        priceClass = "cheap";
                    } else if (item.price_kwh > 0.1) { // 40 Ft felett (kb)
                        priceClass = "expensive";
                    }

                    // HTML elem létrehozása
                    const card = document.createElement('div');
                    card.className = `card ${priceClass}`;
                    card.innerHTML = `
                        <div class="time">${hours}</div>
                        <div class="price-box">
                            <span class="price">${priceText}</span>
                            <span class="unit">€/kWh</span>
                        </div>
                    `;
                    container.appendChild(card);
                });

            } catch (error) {
                document.getElementById('loading').innerText = "⚠️ Még nincs friss adat mára.";
                console.error(error);
            }
        }

        loadPrices();
    </script>
</body>
</html>
